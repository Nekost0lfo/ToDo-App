name: Deploy ToDo App

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker image
      run: |
        cd server
        docker build -t ${{ secrets.DOCKER_USERNAME }}/todo-app:latest .
    
    - name: Push to Docker Hub
      run: |
        docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
        docker push ${{ secrets.DOCKER_USERNAME }}/todo-app:latest
    
    - name: Test Kubernetes manifests
      run: |
        echo "Проверка YAML файлов:"
        kubectl apply -f k8s/ --dry-run=client && echo "✅ Все манифесты валидны"
    
    - name: Show deployment commands
      run: |
        echo "Для развертывания выполните:"
        echo "1. minikube start --memory=4096 --cpus=4"
        echo "2. kubectl apply -f k8s/"
        echo "3. minikube service todo-app-service --url"
